# Caching settings for CDN
proxy_cache cdn_cache;
proxy_cache_valid 200 302 31d;
proxy_cache_valid 404      1m;

# Use stale cache if origin is down
proxy_cache_use_stale error timeout http_500 http_502 http_503 http_504;
proxy_cache_lock on;
proxy_cache_background_update on;
proxy_cache_revalidate on;

# Force cache: ignore origin's cache-control/cookies to keep files for a month
proxy_ignore_headers Cache-Control Expires Set-Cookie;
proxy_hide_header Set-Cookie;

# Show cache status in headers
add_header X-Cache-Status $upstream_cache_status;
add_header X-CDN-Node $hostname;
add_header Cache-Control "public, max-age=2678400, immutable";
