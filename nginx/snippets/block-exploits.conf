# 1. Запрещаем доступ к скрытым файлам (начинаются с точки), кроме well-known (для SSL)
location ~ /\.(?!well-known).* {
    deny all;
    access_log off;
    log_not_found off;
}

# 2. Запрещаем только конкретно опасные файлы в корне или по расширению
location ~* ^.*\.(sql|bak|old|php|aspx|jsp|cgi|pl|sh|lua|config|zip|tar|gz|rar|swp|dist|env|ini|log|conf)$ {
    deny all;
    access_log off;
    log_not_found off;
}

# 3. Блокируем специфичные опасные пути
location ~* ^/(wp-admin|wp-login|administrator|phpmyadmin|pma|webdav|server-status|install|setup|.git|.ssh|.env) {
    deny all;
    access_log off;
    log_not_found off;
}

# 4. Проверка методов
if ($request_method !~ ^(GET|HEAD|POST|PUT|PATCH|DELETE|OPTIONS)$ ) {
    return 444;
}

# Блокировка тупых скриптов (сделано мягче)
# if ($http_user_agent = "") { 
#     return 444; 
# }

# 5. Блокировка только самых агрессивных ботов
if ($http_user_agent ~* (Httrack|Zgrab|Masscan|censys|libwww)) {
    return 403;
}